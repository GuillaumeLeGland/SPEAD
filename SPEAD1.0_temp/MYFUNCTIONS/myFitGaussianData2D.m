function [] = myFitGaussianData2D()

%***********************************************************************************
%***********************************************************************************
%===================================================================================
%...................................................................................
%...................................................................................
%...................................................................................
%===================================================================================
%***********************************************************************************
return
% <http://www.mathworks.com/help/stats/fitgmdist.html>
% <http://www.mathworks.com/help/stats/gmdistribution.fit.html>
%===================================================================================
%Generate data from a mixture of two bivariate Gaussian distributions.
%...................................................................................
mu1 = [ 1  2];
mu2 = [-3 -5];
%...................................................................................
Sigma1 = [2 0; 0 0.5];
Sigma2 = [1 0; 0 1.0];
%...................................................................................
rng(1); % For reproducibility
X = [mvnrnd(mu1,Sigma1,1000);...
     mvnrnd(mu2,Sigma2,1000)];
%...................................................................................
%Fit a Gaussian mixture model. Specify that there are two components.
k = 2;
% $$$ GMModel = fitgmdist(X,2);
GMModel = gmdistribution.fit(X,k)
%...................................................................................
%Plot the data over the fitted Gaussian mixture model contours.
%...................................................................................
figure(10)
y = [zeros(1000,1);ones(1000,1)];
h = gscatter(X(:,1),X(:,2),y);
hold on
ezcontour(@(x1,x2)pdf(GMModel,[x1 x2]),get(gca,{'XLim','YLim'}))
title('{\bf Scatter Plot and Fitted Gaussian Mixture Contours}')
legend(h,'Model 0','Model1')
hold off
%...................................................................................
%===================================================================================
%...................................................................................
xmean = 1;
ymean = 2;
%...................................................................................
xymean = [xmean,ymean];
%...................................................................................
xsigma = sqrt(2.0);
ysigma = sqrt(1.5);
%...................................................................................
covxy = zeros(2,2);
%...................................................................................c
covxy(1,1) = (xsigma)^2; %Autocorrelation.
covxy(2,2) = (ysigma)^2;
%...................................................................................
covxy(2,1) = sqrt(0.5)^2; %Crosscorrelation.
covxy(1,2) = sqrt(0.5)^2; 
%...................................................................................
xy = mvnrnd(xymean,covxy,1000);
%...................................................................................
x = xy(:,1); %(eg. Cuantas veces aparece la mumaxj en mi phytoplankton community)
y = xy(:,2); %(eg. Cuantas veces aparece la Topt-j en mi phytoplankton community)
%...................................................................................
%%xj = mupmj * (phyj/phytot);
%%yj = Toptj * (phyj/phytot);
%...................................................................................
crosscorelxy = corr(x,y);
crosscovarxy = sqrt(crosscorelxy); %Should be similar to the off-diagonal elements of the covxy matrix.
%...................................................................................
%Fit a Gaussian mixture model.
k = 1;
GMModel = gmdistribution.fit(xy,k);
%...................................................................................
xymeanFit = GMModel.mu;
covxyFit  = GMModel.Sigma;
%...................................................................................
xmeanFit = xymeanFit(1);
ymeanFit = xymeanFit(2);
%...................................................................................
xsigmaFit = sqrt(covxyFit(1,1));
ysigmaFit = sqrt(covxyFit(2,2));
%...................................................................................
PDF = @(x1,x2)pdf(GMModel,[x1 x2]);
%%PDF = pdf(GMModel,[x1 x2]); %Doesnt work.
%...................................................................................
%Plot the data over the fitted Gaussian mixture model contours.
figure(10)
subplot(2,2,1)
hist(x)
subplot(2,2,2)
hist(y)
subplot(2,2,3)
h = gscatter(x,y);
hold on
ezcontour(PDF)
get(gca,'YLim')
get(gca,'XLim')
title('{\bf Scatter Plot and Fitted Gaussian Mixture Contours}')
legend(h,'Fitted Model')
hold off
%...................................................................................
%===================================================================================
%***********************************************************************************
return

%===================================================================================
% <http://www.mathworks.com/help/curvefit/fit.html> 
%...................................................................................
[x,y] = titanium;
gaussEqn = 'a*exp(-((x-b)/c)^2)+d'
startPoints = [1.5 900 10 0.6]
%...................................................................................
fitx = fit(x(:),y(:),gaussEqn,'Start', startPoints, 'Exclude', x < 800)
%...................................................................................
figure(10)
plot(fitx,x,y)
title('Fit with data points excluded such that x < 800')
%...................................................................................
%===================================================================================
%...................................................................................
xmin = -2; 
xmax = +8; 
sigmaPcnt = 0.2;
nbins = 64;
%...................................................................................
[fx,xaxis,xmean,xsigma] = myGaussianDistribution1D(xmin,xmax,sigmaPcnt,nbins);
%...................................................................................
fitx = fit(xaxis(:),fx(:),gaussEqn)
%...................................................................................
figure(20)
plot(fitx,xaxis,fx)
%...................................................................................
%===================================================================================
%...................................................................................
xlag = 0;
ylag = 0;
xmin = -2; 
ymin = -2; 
xmax = +8; 
ymax = +8; 
xsigma = 2.0;
ysigma = 2.0;
xnbins = 64;
ynbins = 64;
%...................................................................................
[FXY,XAXIS,YAXIS] = myGaussianDistribution2D(xmin,ymin,xmax,ymax,xlag,ylag,xsigma,ysigma,xnbins,ynbins);
%...................................................................................
gaussEqn2D = 'Axy * exp(-( (x-avex).^2/(2*sigx^2) + (y-avey).^2/(2*sigy^2) ))';
%...................................................................................
fitxy = fit([XAXIS(:),YAXIS(:)],FXY(:),gaussEqn2D);
%...................................................................................
figure(30)
subplot(2,2,1)
imagesc(FXY)
mycolorbar
subplot(2,2,2)
plot(fitxy,[XAXIS(:),YAXIS(:)],FXY(:))
%...................................................................................
%===================================================================================
%...................................................................................
xlag = 0;
%%xlag = 5;
ylag = 0;
xmin = -2; 
ymin = -2; 
xmax = +8; 
ymax = +8; 
xsigma = 2.0;
%%ysigma = 2.0; %Original.
ysigma = 1.0; %Just by decreasing ysigma by half the method now fails to converge. Shit!
xnbins = 64;
ynbins = 64;
%...................................................................................
xmean = mean([xmin:xmax]) + xlag;
ymean = mean([ymin:ymax]) + ylag;
%...................................................................................
[FXY,XAXIS,YAXIS] = myGaussianDistribution2D(xmin,ymin,xmax,ymax,xlag,ylag,xsigma,ysigma,xnbins,ynbins);
%...................................................................................
gaussEqn2D = 'Axy * exp(-( (x-avex).^2/(2*sigx^2) + (y-avey).^2/(2*sigy^2) ))';
%...................................................................................
fitxy = fit([XAXIS(:),YAXIS(:)],FXY(:),gaussEqn2D);
fitxy
%...................................................................................
xmean
ymean
xsigma
ysigma
%...................................................................................
figure(40)
subplot(2,2,1)
imagesc(FXY)
mycolorbar
subplot(2,2,2)
plot(fitxy,[XAXIS(:),YAXIS(:)],FXY(:))
%...................................................................................
%===================================================================================
%...................................................................................
%...................................................................................
%===================================================================================

