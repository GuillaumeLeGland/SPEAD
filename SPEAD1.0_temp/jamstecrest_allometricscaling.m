close all
clear all

%%%%%%%%%%%%%%%%%%%%%
%MAXIMUM GROWTH RATE: 
%%%%%%%%%%%%%%%%%%%%%
%====================================================================
%....................................................................
logVOL = [0:0.2:8.0]; %log10 of cell volume
%....................................................................
VOL = 10.^(logVOL); %cell volume [um3] 
ESD = 2 * ((3*VOL)/(4*pi)).^(1/3); %equivalent spherical diameter [um] 
ESR = ESD/2; %equivalent spherical radius [um] 
%....................................................................
Alfa = +5.00; 
Beta = -0.24; %(-0.24) 
%....................................................................
loga =  log10(Alfa); %(0.7) 
%....................................................................
logMUP = loga + Beta*logVOL; %(see EDWARDS etal 2012, L&O)
%....................................................................
MUP = Alfa * VOL.^(Beta); %[d-1] 
%....................................................................
MUPbis = 10.^(logMUP); 
%....................................................................
%====================================================================

%%%%%%%%%%%%%%%%%%%%%%%%%%
%HALF SATURATION CONSTANT: 
%%%%%%%%%%%%%%%%%%%%%%%%%%
%====================================================================
%....................................................................
Alfa = 0.142;
Beta = 0.330;
%....................................................................
loga = log10(Alfa); %(-0.84) 
%....................................................................
logKNP = loga + Beta*logVOL; %(see EDWARDS etal 2012, L&O) 
%....................................................................
KNP = Alfa * VOL.^(Beta); %[mmolN * m-3]
%....................................................................
%====================================================================

%%%%%%%%%%%%%%%%%
%UPTAKE AFFINITY:
%%%%%%%%%%%%%%%%%
%====================================================================
%....................................................................
AFF = MUP./KNP; %[m3*mmolN-1*d-1] 
%....................................................................
CTE = MUP .* AFF; %[m3*mmolN-1*d-2] Should be constat for a trade-off to exist (but is not constant)
%....................................................................
%====================================================================

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%MAXIMUM UPTAKE PER CELL (VMAX):
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%====================================================================
%....................................................................
Alfa = 0.8d-8;
Beta = 0.82;
%....................................................................
loga = log10(Alfa); %(-8.1) 
%....................................................................
logVMAX = loga + Beta*logVOL; %(see EDWARDS etal 2012, L&O) 
%....................................................................
VMAXumolN = Alfa * VOL.^(Beta); %[umolN * cell-1 * d-1]
%....................................................................
VMAX = VMAXumolN * (1/1000); %[umolN * cell-1 * d-1] x [mmolN * umolN-1] = [mmolN * cell-1 * d-1] 
%....................................................................
logVMAX = log10(VMAX);
%....................................................................
%====================================================================
%....................................................................
CDF = 0.25*(1/1d12)*(1.00/12.00)*(1/1000); %Carbon Density Factor: [pgC*um-3] x [gC*pgC-1] x [molC*gC-1] x [mmolC*molC-1] = [mmolC*um-3]
%....................................................................
NDF = CDF * (16.0/106.0); %Nitrogen density factor [mmolN*um-3]
%....................................................................
BIO = VOL*NDF; %Biomass per cell: [um3 * cell-1] x [mmolN*um-3] = [mmolN * cell-1] 
%....................................................................
VMAXbis = MUP .* BIO; %[mmolN * cell-1 * d-1] 
%....................................................................
logVMAXbis = log10(VMAXbis); 
%....................................................................
%====================================================================

%%%%%%%%%%%%%%%%%%%%%%%%%%
%UPTAKE AFFINITY PER CELL:
%%%%%%%%%%%%%%%%%%%%%%%%%%
%====================================================================
%....................................................................
ALFA = VMAX./KNP; %[mmolN * cell-1 * d-1] / [mmolN * m-3] = [m3 * cell-1 * d-1]
%....................................................................
logALFA = log10(ALFA); 
%....................................................................
%====================================================================
%....................................................................
vmax0 = 10.^(5.0); %[umol * cell-1 * d-1]
knp0  = 10.^(0.5); %[umol * L-1] 
%....................................................................
alfa0  = vmax0/knp0; %[L * cell-1 * d-1] 
alfa0 = alfa0 * (1/(3600*24)); %[L * cell-1 * sec-1]
%....................................................................
%====================================================================

%%%%%%%%%%%%%%%%
%DIFFUSIVE FLUX:
%%%%%%%%%%%%%%%%
%====================================================================
%....................................................................
DIN = 0.5; %[mmolN*m-3] 
%....................................................................
Diff = 1000 * ((24*3600)/1); %[um2 * sec-1] x [sec * d-1] = [um2 * d-1] 
%....................................................................
% $$$ Diff = 1000 * (1/1000) * (1/1000) * ((24*3600)/1); %[um2 * sec-1] * [m * um-1] x [m * um-1] x [sec * d-1] = [m2 * d-1] 
%....................................................................
Jflux = (4*pi)*Diff*(ESR)*DIN; %[um2*d-1] x [um*cell-1] x [mmolN*m-3] = [(um3 * cell-1 * d-1) * (mmolN * m-3)] = [mmolN * (um3/m-3) * cell-1 * d-1]
%...................................................................
Jfluxpervol = Jflux./VOL; %[(um3 * cell-1 * d-1) * (mmolN * m-3)] x [um3 * cell-1] = [mmolN * m-3 * d-1] 
%....................................................................
%====================================================================

%%%%%%%
%PLOTS:
%%%%%%%
%====================================================================
%....................................................................
logESD = log10(ESD);
%....................................................................
figure(10)
%....................................................................
subplot(2,2,1)
plot(logESD,MUP,'*')
xlabel('log ESD')
ylabel('mup (d-1)')
title('max growth rate')
grid on
%....................................................................
subplot(2,2,2)
plot(logESD,KNP,'*')
xlabel('log ESD')
ylabel('knp (mmolN*m-3)')
title('half-sat constant')
grid on
%....................................................................
subplot(2,2,3)
plot(logESD,AFF,'*')
xlabel('log ESD')
ylabel('aff (mmolN*m-3)')
title('affinity')
grid on
%....................................................................
subplot(2,2,4)
plot(logESD,CTE,'*')
xlabel('log ESD')
ylabel('aff * mup = constant ?')
title('trade-off checking')
grid on
%....................................................................
print('-dpng','-r100','jamstecrest_allometricscaling_fig001.png')
%....................................................................
%====================================================================
%********************************************************************
return

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%AKSNESS AND EGGE (1991) MODEL:
%(see also LINDEMANN etal (2016)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%====================================================================
%--------------------------------------------------------------------
% NOTE: I AM ASSUMING A CHEMOSTAT WITH FIXED VOLUME EQUAL TO 1 LITRE: 
%--------------------------------------------------------------------
% R :: radius of the cell (m2) 
% D :: molecular diffusion coeff (m2 * sec-1) 
% v :: mass transfer coefficient (m * sec-1) 
% n :: number of uptake sites (porters * cell-1) 
% p :: percentage of area covered with uptake sites (n.d.) 
%--------------------------------------------------------------------
% s :: surface area of each uptake site (m2 * porter-1) 
% S :: surface area of all uptake sites (m2 * cell-1) 
%--------------------------------------------------------------------
% h :: handling rate of each uptake site (molec * sec-1 * porter-1) 
% H :: handling rate of all uptake sites (molec * sec-1 * cell-1) 
%--------------------------------------------------------------------
% a :: affinity of each uptake site (m3 * sec-1 * porter-1) 
% A :: affinity of all uptake sites (m3 * sec-1 * cell-1) 
%--------------------------------------------------------------------
% Smax :: maximum cell surface area (m2 * cell-1) 
% Vmax :: maximum cell handling rate (molec * sec-1 * cell-1) 
% ksat :: half-saturation constant (molec * m-3) 
%--------------------------------------------------------------------
%====================================================================
%....................................................................
R = 3.0*1d-6; %[m2] 
D = 1.5*1d-9; %[m2 * sec-1] 
n = 1.0*1d6; %[porters * cell-1] 
h = 1.0*1d3; %[molec * sec-1 * porter-1] 
s = 1.0*1d-17; %[m2 * porter-1] 
%....................................................................
v = D / R; %[m2 * sec-1] / [m] = [m * sec-1] 
%....................................................................
Stot = (4*pi*R^2); %[m2] 
%....................................................................
S = n * s; %[porter * cell-1] x [m2 * porter-1] = [m2 * cell-1] 
H = n * h; %[porter * cell-1] x [molec * sec-1 * porter-1] = [molec * sec-1 * cell-1]
%....................................................................
a = v * s; %[m * sec-1] x [m2 * porter-1] = [m3 * sec-1 * porter-1] 
A = v * S; %[m * sec-1] x [m2 *   cell-1] = [m3 * sec-1 *   cell-1] 
%....................................................................
vmax = (n * h); %[porters * cell-1] x [molec * sec-1 * porter-1] = [molec * sec-1 * cell-1]
ksat = (h / a); %[molec * sec-1 * porter-1] / [m3 * sec-1 * porter-1] = [molec * m-3] 
%....................................................................
Vmax =  H; %[molec * sec-1 * cell-1] 
Ksat =  H / A; %[molec * sec-1 * cell-1] / [m3 * sec-1 *   cell-1] = [molec * m-3] 
%....................................................................
p = (S / Stot); %[n.d.] 
%....................................................................
Vbis = vmax * (DIN / (ksat + DIN)); 
V    = Vmax * (DIN / (Ksat + DIN)); 
%....................................................................
%====================================================================
%....................................................................
R = 3.0*1d-6; %[m] 
D = 1.5*1d-9; %[m2 * sec-1] 
h = 1.0*1d3; %[molec * sec-1 * porter-1] 
s = 1.0*1d-17; %[m2 * porter-1] 
p = 0.0884; %[n.d] (0 - 1) 
%....................................................................
v = (D / R); %[m2 * sec-1] / [m] = [m * sec-1] 
%....................................................................
r = sqrt( s/(4*pi)); %[m] radius of each porter 
%....................................................................
Stot = (4*pi*R^2); %[m2 * cell-1] 
%....................................................................
S = p * Stot; 
%....................................................................
n = S / s; %[porters] 
%....................................................................
n0 = n / S; %[porters * m-2] porter density 
%....................................................................
ptot = n0 * s; %should be equal to one. 
%....................................................................
Amax = ptot * Stot * (D/R); %maximum cell affinity [m3 * sec-1 * cell-1] 
%....................................................................
Abis = p    * Stot * (D/R); %cell affinity [m3 * sec-1 * cell-1] 
%....................................................................
pbis = Abis / Amax; %[n.d] (0 - 1)
%....................................................................
H = n * h; %[porter * cell-1] x [molec * sec-1 * porter-1] = [molec * sec-1 * cell-1]
A = v * S; %[m * sec-1] x [m2 *   cell-1] = [m3 * sec-1 *   cell-1] 
%....................................................................
Vmax =  H; %[molec * sec-1 * cell-1] 
Ksat =  H / A; %[molec * sec-1 * cell-1] / [m3 * sec-1 *   cell-1] = [molec * m-3] 
%....................................................................
V    = Vmax * (DIN / (Ksat + DIN)); 
%....................................................................
%====================================================================

